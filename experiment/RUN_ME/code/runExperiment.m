% Runs all the stages of the experiment.
% trials - a table of trials generated by "getTrials", includes the stimuli and timing of each trial.
%       Same for preactice_trials and practice_wo_prime_trials.
% is_reach - 1=sub responds with reaching , 0=responds with keybaord.
% p - all experiment's parameters.
function [p] = runExperiment(trials, practice_trials, practice_wo_prime_trials, is_reach, p)
    switch p.DAY
        case 'day1'
            % Example trial.
            showTexture(p.TRIAL_EXAMPLE_SCREEN, p);
            getInput('instruction', p);
            exampleTrial(trials, 0, is_reach, p);
            
            % test.
            showTexture(p.TEST_SCREEN, p);
            getInput('instruction', p);
            p = runTrials(trials, 0, is_reach, p);
        case 'day2'

            % Response method explanation.
            if is_reach
                showTexture(p.REACH_RESPONSE_EXPLANATION, p);
                getInput('instruction', p);
            else
                showTexture(p.KEYBOARD_RESPONSE_EXPLANATION, p);
                getInput('instruction', p);
            end

            % Example trial.
            showTexture(p.TRIAL_EXAMPLE_SCREEN, p);
            getInput('instruction', p);
            exampleTrial(trials, 0, is_reach, p);

            % practice w/o prime.
            showTexture(p.SPEED_PRACTICE_SCREEN, p);
            getInput('instruction', p);
            p = runTrials(practice_wo_prime_trials, 0, is_reach, p);

            % 2nd instructions.
            showTexture(p.SECOND_INSTRUCTIONS_SCREEN, p);
            getInput('instruction', p);

            % Example trial with prime.
            showTexture(p.TRIAL_EXAMPLE_SCREEN, p);
            getInput('instruction', p);
            exampleTrial(trials, 1, is_reach, p);

            % practice with prime.
            showTexture(p.PRACTICE_SCREEN, p);
            getInput('instruction', p);
            p = runTrials(practice_trials, 1, is_reach, p);

            % test.
            showTexture(p.TEST_SCREEN, p);
            getInput('instruction', p);
            p = runTrials(trials, 1, is_reach, p);
    end
    
    showTexture(p.SAVING_DATA_SCREEN, p);
    fixOutput(p);
end